function [u] = boundary_linear(u,ub)
% 3-stencil boundary linearizer.
[x, y, z] = size(u);




% ub(1,:,:) = (u(2,:,:)+u(3,:,:))/3; 
% ub(2,:,:) = ub(1,:,:)+(u(3,:,:)-ub(1,:,:))/2; 
% 
% ub(x,:,:) = (u(x-1,:,:)+u(x-2,:,:))/3; 
% ub(x-1,:,:) = ub(x,:,:)+(u(x-2,:,:)-ub(x,:,:))/2; 
% 
% %------------------------
% 
% ub(:,1,:) = (u(:,2,:)+u(:,3,:))/3; 
% ub(:,2,:) = ub(:,1,:)+(u(:,3,:)-ub(:,1,:))/2; 
% 
% ub(:,y,:) = (u(:,y-1,:)+u(:,y-2,:))/3; 
% ub(:,y-1,:) = ub(:,y,:)+(u(:,y-2,:)-ub(:,y,:))/2; 
% 
% %------------------------
% 
% ub(:,:,1) = (u(:,:,2)+u(:,:,3))/3; 
% ub(:,:,2) = ub(:,:,1)+(u(:,:,3)-ub(:,:,1))/2; 
% 
% ub(:,:,z) = (u(:,:,z-1)+u(:,:,z-2))/3; 
% ub(:,:,z-1) = ub(:,:,z)+(u(:,:,z-2)-ub(:,:,z))/2; 




ub(1,:,:) = (u(2,:,:)+u(3,:,:))/3; 
ub(2,:,:) = ub(1,:,:)+(u(3,:,:)-ub(1,:,:))/2; 

ub(x,:,:) = (u(x-1,:,:)+u(x-2,:,:))/3; 
ub(x-1,:,:) = ub(x,:,:)+(u(x-2,:,:)-ub(x,:,:))/2; 

%------------------------

ub(:,1,:) = (u(:,2,:)+u(:,3,:))/3; 
ub(:,2,:) = ub(:,1,:)+(u(:,3,:)-ub(:,1,:))/2; 

ub(:,y,:) = (u(:,y-1,:)+u(:,y-2,:))/3; 
ub(:,y-1,:) = ub(:,y,:)+(u(:,y-2,:)-ub(:,y,:))/2; 

%------------------------

ub(:,:,1) = (u(:,:,2)+u(:,:,3))/3; 
ub(:,:,2) = ub(:,:,1)+(u(:,:,3)-ub(:,:,1))/2; 

ub(:,:,z) = (u(:,:,z-1)+u(:,:,z-2))/3; 
ub(:,:,z-1) = ub(:,:,z)+(u(:,:,z-2)-ub(:,:,z))/2; 




u(1,:,:) = ub(1,:,:); 
u(2,:,:) = ub(2,:,:); 
u(x,:,:) = ub(x,:,:);  
u(x-1,:,:) = ub(x-1,:,:); 
u(:,1,:) = ub(:,1,:);   
u(:,2,:) = ub(:,2,:);   
u(:,y,:) = ub(:,y,:);   
u(:,y-1,:) = ub(:,y-1,:);   
u(:,:,1) = ub(:,:,1);  
u(:,:,2) = ub(:,:,2); 
u(:,:,z) = ub(:,:,z);  
u(:,:,z-1) = ub(:,:,z-1);


